---
import AddReviewModal from "@/components/modals/review/AddReviewModal.astro";
import { getRestaurantById } from "@/repository/restaurants";

const { restaurant, user, reviews } = Astro.props;


---
<!-- INICIO DEL COMPONENTE DE LA TARJETA -->
<div class="bg-white shadow-lg overflow-hidden py-8 antialiased md:py-8 max-w-screen-xl mx-auto rounded-xl px-4 sm:px-6 lg:px-8">
    <!-- Imagen Principal -->
    <div>
        <img src={restaurant.photo} alt={restaurant.name} class="w-full h-72 object-cover">
    </div>

    <!-- Información y Enlaces -->
    <div class="p-6">
        <div class="flex justify-between items-start md:items-center flex-wrap">
            <!-- Nombre y Dirección -->
            <div class="flex-grow mb-4 md:mb-0">
                <div class="flex items-center mb-1">
                    <h1 class="text-3xl font-bold text-slate-800">{restaurant.name}</h1>
                    <button aria-label="Añadir a favoritos" class="ml-3 text-slate-400 hover:text-pink-500">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7">
                            <path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.218l-.022.012-.007.004-.004.001a.752.752 0 01-.704 0l-.003-.001z" />
                        </svg>
                    </button>
                </div>
                <p class="text-sm text-slate-600">{restaurant.address}</p>
            </div>

            <!-- Enlaces -->
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 w-full sm:w-auto">
                <a href={restaurant.website} class="flex-1 sm:flex-none px-5 py-2 border border-slate-300 rounded-full text-sm text-slate-700 hover:bg-slate-100 transition-colors text-center whitespace-nowrap">
                    Website
                </a>
                <a href={restaurant.maps_url} class="flex-1 sm:flex-none px-5 py-2 border border-slate-300 rounded-full text-sm text-slate-700 hover:bg-slate-100 transition-colors text-center whitespace-nowrap">
                    Map Place
                </a>
            </div>
        </div>
    </div>

    <!-- Sección de Reseñas -->
    <div class="px-6 pt-4 pb-2">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-semibold text-slate-800">Reviews</h2>
            <button
            data-modal-target="addReviewModal"
            data-modal-toggle="addReviewModal"
            type="button"
            class="text-sm text-sky-600 hover:text-sky-700 hover:underline whitespace-nowrap"
            >
            Add Review
            </button>

            
        </div>
    </div>

    <!-- Lista de Cards de Reseñas -->
    <!-- Lista de Cards de Reseñas -->
<div class="px-6 pb-6 space-y-4">
    {reviews.length === 0 && (
      <p class="text-slate-500 text-sm">Todavía no hay reseñas para este restaurante.</p>
    )}
  
    {reviews.map((review: ReviewWithUser) => (
      <div class="bg-amber-50 p-4 rounded-lg shadow-sm">
        <div class="flex items-center mb-2">
          <h3 class="font-semibold text-slate-800">{review.userName} {review.userSurname}</h3>
          {review.digestiveCondition && (
            <span class="ml-3 px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full">
              {review.digestiveCondition}
            </span>
          )}
        </div>
        <p class="text-sm text-slate-700 mb-2 leading-relaxed">
          {review.description}
        </p>
        <p class="text-sm font-medium text-slate-600">Menú adecuado: {review.suitable ? "Sí" : "No"}</p>
      </div>
    ))}
  </div>
</div>
<!-- FIN DEL COMPONENTE DE LA TARJETA -->
<AddReviewModal user={user} restaurant = {restaurant} />