---
import { getUserFromSession } from "@/repository/users";
import LayoutUser from "@/layouts/LayoutUser.astro";
import DashboardPanel from "@/components/user/dashboardPanel.astro";


if (Astro.locals.user === null) {
  return Astro.redirect('/login'); // Redirigir a login si no hay usuario autenticado
}

// ⚠️ Evita el acceso si no hay cookie
const sessionToken = Astro.cookies.get("session")?.value;
if (!sessionToken) {
  return Astro.redirect('/login');
}

const user = await getUserFromSession(sessionToken);
if (!user) {
  return Astro.redirect('/login');
}

---
<LayoutUser user={user}>
    <DashboardPanel user={user}>
</LayoutUser>
